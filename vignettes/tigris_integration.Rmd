---
title: "Integrating Census Bureau Data with Tigris"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{tigris_integration}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
# Introduction

`dhomer` allows users to calculate proximity and accessibility to various data points from a geographic address input in order to essentially
compute adjacency to determinants of health. Many determinants of health are integrated into the Census Bureau American Community Survey
population estimates collected every 1 and 5 years, respectively. The `tigris` package functions allows us to call and integrate ACS data into the
`dhomer` functions for more comprehensive determinants of health computation.

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## `Tigris` Variables

```{r setup}
# library(dhomer)
library(tidycensus)
library(dplyr)
census_api_key(Sys.getenv("CENSUS_API_KEY"), install=TRUE, overwrite = TRUE)

variables <- load_variables(2019,'acs5')
View(variables)

```

`load_variables()` will create an interactive table of all of the variable codes and their labels for your defined survey. The preceding code will
generate a table of the 2019 5-Year American Community Survey. The table can be easily searched to find variables of interest to then pull data
for. 

By scanning the `variables` table, we identified three variables of particular interest to determinants of health:
* B17021_002- Estimate!!Total:!!Income in the past 12 months below poverty level
* B06009_002- Estimate!!Total:!!Less than high school graduate
* B11001_008- Estimate!!Total:!!Nonfamily households:!!Householder living alone

## Calling ACS Data

```{r}

# Percent of South Carolina Households with Income Below Poverty Level in the Past 12 Months

poverty <- get_acs(
  geography = 'block group',
  state = 'SC',
  variables = 'B17021_002',
  year = 2019
)

block_group_population <- get_acs(
  geography = 'block group',
  state = 'SC',
  variables = 'B01003_001',
  year = 2019
)

percent_below_poverty_level <- poverty %>%
  mutate(percent = 100 * (poverty$estimate/block_group_population$estimate)) %>%
  select(GEOID, NAME, variable, percent)
```

The `get_acs()` function retrieves the data from the ACS based on the granularity, geography, variable, and year you define. Data from the
Decennial Census of Population and Housing can also be retrieved with `get_decennial()`. stimates are given by number of people, sbut the data can
be normalized through computing percentages of the population by calling both your variable of interest and the total population with all other
definitions held constant and utilizing the `mutate()` and `select()` functions of `dplyr`.
