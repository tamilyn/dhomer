---
title: "Integrating ACS Census Bureau Data with Tidycensus"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{acs_integration}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
# Introduction

`dhomer` allows users to calculate proximity and accessibility to various data points from a geographic address input in order to essentially
compute adjacency to determinants of health. Many determinants of health are integrated into the Census Bureau American Community Survey
population estimates collected every 1 and 5 years, respectively. The `tigris` package functions allows us to call and integrate ACS data into the
`dhomer` functions for more comprehensive determinants of health computation.

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
options(rmarkdown.html_vignette.check_title = FALSE)

```

## `Tigris` Variables

```{r setup}
pacman::p_load(tidycensus, tidyverse, dplyr)
census_api_key(Sys.getenv("CENSUS_API_KEY"), install=TRUE, overwrite = TRUE)
readRenviron("~/.Renviron")

variables <- load_variables(2019,'acs5')

```

By scanning the `variables` table, we identified three variables of particular interest to determinants of health: B17021_002- Estimate!!Total:!!Income in the past 12 months below poverty level, B06009_002- Estimate!!Total:!!Less than high school graduate, B11001_008- Estimate!!Total:!!Nonfamily households:!!Householder living alone

## Calling ACS Data

```{r}

# Percent of South Carolina Households with Income Below Poverty Level in the Past 12 Months

poverty <- get_acs(
  geography = 'block group',
  state = 'SC',
  variables = 'B17021_002',
  year = 2019
)

block_group_population <- get_acs(
  geography = 'block group',
  state = 'SC',
  variables = 'B01003_001',
  year = 2019
)

percent_below_poverty_level <- poverty %>%
  mutate(percent = 100 * (poverty$estimate/block_group_population$estimate)) %>%
  select(GEOID, NAME, variable, percent)

glimpse(percent_below_poverty_level)
```

The `get_acs()` function retrieves the data from the ACS based on the granularity, geography, variable, and year you define, then estimates can be easily attained with the `dplyr::mutate()` function.
